# Worker + DO + D1 only. Deploy with: wrangler deploy --config wrangler.worker.toml
# Pages uses wrangler.toml (Pages-only); this file is for the go.suqram.com Worker.
name = "suqram"
main = "src/worker.ts"
compatibility_date = "2026-01-23"
compatibility_flags = ["nodejs_compat"]
account_id = "e51733a914697da87e60c4d6f4a5aef6"

[durable_objects]
bindings = [
  { name = "LINK_GUARD", class_name = "LinkGuardDO" },
  { name = "SITES", class_name = "SitesDO" },
  { name = "REDEMPTION_PERMIT", class_name = "RedemptionPermitDO" },
  { name = "INTENT_NONCE", class_name = "IntentNonceDO" },
  { name = "TENANT_CONFIG", class_name = "TenantConfigDO" },
  { name = "TOKEN_REFRESH_MUTEX", class_name = "TokenRefreshMutexDO" }
]

[[d1_databases]]
binding = "EIG_DB"
database_name = "eig-db"
database_id = "c7e80648-3f94-491d-b24f-0881d7f1a1ab"
preview_database_id = "c7e80648-3f94-491d-b24f-0881d7f1a1ab"

[vars]
ORIGIN_BASE_URL = "http://127.0.0.1:8787"
TURNSTILE_ENABLED = "false"
TURNSTILE_SITE_KEY = ""
TURNSTILE_SECRET_KEY = ""
PATH_ALLOWLIST = "/auth,/reset,/verify,/invite,/magic"
QUERY_ALLOWLIST = "token,type,redirect_to,next,state"

[[routes]]
pattern = "go.suqram.com/*"
zone_name = "suqram.com"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["LinkGuardDO"]

[[migrations]]
tag = "v2"
new_sqlite_classes = ["SitesDO"]

[[migrations]]
tag = "v3"
new_sqlite_classes = ["IntentNonceDO", "TenantConfigDO"]

[[migrations]]
tag = "v4"
new_sqlite_classes = ["TokenRefreshMutexDO"]

[[migrations]]
tag = "v5"
new_sqlite_classes = ["RedemptionPermitDO"]
